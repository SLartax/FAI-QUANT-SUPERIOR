name: FAI-QUANT-SUPERIOR Trading System (Email Only)

on:
  schedule:
    # Every weekday at 19:00 CET (18:00 UTC)
    # Mon-Fri: 19:00 CET = 18:00 UTC
    - cron: '0 18 * * 1-5'
  workflow_dispatch:

jobs:
  trading:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - name: Check required secrets
        run: |
          if [ -z "$SMTP_HOST" ]; then echo "ERROR: SMTP_HOST secret is missing"; exit 1; fi
          if [ -z "$SMTP_USER" ]; then echo "ERROR: SMTP_USER secret is missing"; exit 1; fi
          if [ -z "$SMTP_PASS" ]; then echo "ERROR: SMTP_PASS secret is missing"; exit 1; fi
          echo "âœ“ All required secrets found"
        env:
          SMTP_HOST: ${{ secrets.SMTP_HOST }}
          SMTP_USER: ${{ secrets.SMTP_USER }}
          SMTP_PASS: ${{ secrets.SMTP_PASS }}
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      
      - name: Verify Python environment
        run: |
          echo "Python version:"
          python --version
          echo "Installed packages:"
          pip list
      
      - name: Run trading system
        env:
          SMTP_HOST: ${{ secrets.SMTP_HOST }}
          SMTP_PORT: ${{ secrets.SMTP_PORT || '587' }}
          SMTP_USER: ${{ secrets.SMTP_USER }}
          SMTP_PASS: ${{ secrets.SMTP_PASS }}
          EMAIL_TO: ${{ secrets.EMAIL_TO || 'pioggiamarrone@gmail.com' }}
          EMAIL_FROM_NAME: ${{ secrets.EMAIL_FROM_NAME || 'FAI-QUANT-SUPERIOR' }}
          TZ: Europe/Rome
          GITHUB_RUN_ID: ${{ github.run_id }}
        run: |
          echo "=== Trading System Execution ==="
          python trading_system.py
      
      - name: Log execution summary
        if: always()
        run: |
          echo "=== Execution Summary ==="
          echo "Run ID: ${{ github.run_id }}"
          echo "Time: $(date -u '+%Y-%m-%d %H:%M:%S %Z')"
          echo "Status: ${{ job.status }}"
